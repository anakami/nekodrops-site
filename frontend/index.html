<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEKO DROPS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
  <style>
    :root {
      --primary-color: #6c5ce7;
      --secondary-color: #a29bfe;
      --accent-color: #fd79a8;
      --dark-color: #2d3436;
      --light-color: #f5f6fa;
      --success-color: #00b894;
      --warning-color: #fdcb6e;
      --danger-color: #d63031;
      --vip-gold: #ffd700;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: var(--light-color);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header Styles */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .logo {
      font-size: 28px;
      font-weight: 700;
    }
    
    .logo span {
      color: var(--accent-color);
    }
    
    .auth-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .login-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    .login-btn:hover {
      background: #5d4ae0;
    }
    
    .hidden {
      display: none;
    }
    
    /* Filters */
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--light-color);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .filter-btn.active, .filter-btn:hover {
      background: var(--primary-color);
    }
    
    /* Drops Grid */
    .drops-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .drop-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .drop-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .drop-card.vip {
      border-color: var(--vip-gold);
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
    }
    
    .drop-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--primary-color);
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .drop-card.vip .drop-badge {
      background: var(--vip-gold);
      color: var(--dark-color);
    }
    
    .drop-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: var(--light-color);
      font-weight: 600;
    }
    
    .account-credentials {
      margin-bottom: 20px;
    }
    
    .credential-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.2);
      padding: 8px 12px;
      border-radius: 6px;
    }
    
    .credential-item span:first-child {
      font-weight: 600;
      margin-right: 8px;
      min-width: 80px;
    }
    
    .credential-value {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .copy-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--light-color);
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 8px;
      transition: background 0.3s;
    }
    
    .copy-btn:hover {
      background: var(--primary-color);
    }
    
    .drop-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .claim-btn {
      background: var(--success-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }
    
    .claim-btn:hover {
      background: #00a382;
    }
    
    .delete-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .delete-btn:hover {
      background: #c02c2c;
    }
    
    /* Connection Status */
    .connection-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 8px 12px;
      border-radius: 20px;
      font-weight: bold;
      z-index: 1000;
      font-size: 12px;
      background: #f44336;
      color: white;
      transition: background 0.3s;
    }
    
    .connection-status.connected {
      background: #4CAF50;
    }
    
    /* Loading */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      grid-column: 1 / -1;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    .no-drops {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .drops-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <div id="connection-status" class="connection-status">❌ Desconectado</div>

  <div class="container">
    <header>
      <div class="logo">NEKO <span>DROPS</span></div>
      <button class="mobile-menu-btn">☰</button>
      <div class="auth-section">
        <div id="user-info" class="user-info hidden">
          <img id="user-avatar" class="user-avatar" src="" alt="Avatar">
          <span id="username"></span>
        </div>
        <button id="login-btn" class="login-btn">Entrar com Discord</button>
      </div>
    </header>

    <div class="filters">
      <button class="filter-btn active" data-filter="all">Todas as Contas</button>
      <button class="filter-btn" data-filter="normal">Contas Normais</button>
      <button class="filter-btn" data-filter="vip">Contas VIP</button>
    </div>

    <div id="drops-container">
      <div class="drops-grid" id="drops-grid">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
    </div>
  </div>

  <script>
    const BACKEND_URL = 'https://nekodrops-backend.onrender.com';
    const VIP_ROLE_ID = "1399662852448587859";
    const OWNER_ROLE_ID = "1399664650638856303";

    const dropsGrid = document.getElementById('drops-grid');
    const connectionStatus = document.getElementById('connection-status');
    const filterButtons = document.querySelectorAll('.filter-btn');
    let user = null, userRoles = [], drops = [], socket = null;
    let currentFilter = 'all';

    function cleanDiscordText(text) {
      if (!text) return "";
      return text.replace(/```/g, "").trim();
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupWebSocket();
      loadDrops();
      setupEventListeners();
    });

    function setupEventListeners() {
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          filterButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          currentFilter = button.dataset.filter;
          renderDrops(currentFilter);
        });
      });
    }

    function setupWebSocket() {
      socket = io(BACKEND_URL, { transports: ['websocket', 'polling'] });
      socket.on('connect', () => {
        connectionStatus.textContent = '✅ Conectado';
        connectionStatus.classList.add('connected');
      });
      socket.on('disconnect', () => {
        connectionStatus.textContent = '❌ Desconectado';
        connectionStatus.classList.remove('connected');
      });
      socket.on('new-drop', dropData => { 
        drops.unshift(dropData); 
        renderDrops(currentFilter); 
      });
      socket.on('drop-deleted', id => { 
        drops = drops.filter(d => d.id !== id); 
        renderDrops(currentFilter); 
      });
    }

    async function loadDrops() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/drops`);
        const data = await res.json();
        drops = data.success ? data.drops : [];
      } catch { drops = []; }
      renderDrops(currentFilter);
    }

    function renderDrops(filter = 'all') {
      clearDrops();
      
      if (!drops.length) {
        dropsGrid.innerHTML = `<div class="no-drops"><h3>Nenhuma conta disponível</h3></div>`;
        return;
      }
      
      // Filtrar drops com base na seleção
      let filteredDrops = drops;
      if (filter === 'vip') {
        filteredDrops = drops.filter(drop => drop.isVip);
      } else if (filter === 'normal') {
        filteredDrops = drops.filter(drop => !drop.isVip);
      }
      
      if (!filteredDrops.length) {
        dropsGrid.innerHTML = `<div class="no-drops"><h3>Nenhuma conta ${filter === 'all' ? 'disponível' : filter === 'vip' ? 'VIP disponível' : 'normal disponível'}</h3></div>`;
        return;
      }
      
      filteredDrops.forEach(d => {
        const isOwner = userRoles.includes(OWNER_ROLE_ID);
        dropsGrid.appendChild(createRobloxAccountElement(d, isOwner));
      });
    }

    function createRobloxAccountElement(account, isOwner) {
      const card = document.createElement('div');
      card.className = `drop-card ${account.isVip ? 'vip' : ''}`;
      card.dataset.id = account.id;

      const username = cleanDiscordText(account.username) || "Conta Roblox";
      const password = cleanDiscordText(account.password) || "";
      const cookie = cleanDiscordText(account.cookie) || "";
      const ip = cleanDiscordText(account.ip) || "";
      const auth = cleanDiscordText(account.authenticator) || "";
      const recovery = cleanDiscordText(account.recovery) || "";

      // 🔹 Detecta o tipo de embed
      let type = "normal";
      if (auth) type = "auth";
      else if (cookie && ip) type = "cookie";
      else if (ip) type = "ip";

      let credentialsHTML = `
        <div class="credential-item">
          <span>Usuário: </span><span class="credential-value">${username}</span>
          <button class="copy-btn" data-value="${username}">Copiar</button>
        </div>
      `;
      
      if (password) {
        credentialsHTML += `
          <div class="credential-item">
            <span>Senha: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${password}">Copiar</button>
          </div>
        `;
      }

      if (type === "cookie") {
        credentialsHTML += `
          <div class="credential-item">
            <span>IP: </span><span class="credential-value">${ip}</span>
            <button class="copy-btn" data-value="${ip}">Copiar</button>
          </div>
          <div class="credential-item">
            <span>Cookie: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${cookie}">Copiar</button>
          </div>`;
      }

      if (type === "auth") {
        credentialsHTML += `
          <div class="credential-item">
            <span>Auth: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${auth}">Copiar</button>
          </div>`;
          
        if (recovery) {
          credentialsHTML += `
            <div class="credential-item">
              <span>Recovery Codes: </span><span class="credential-value">••••••••</span>
              <button class="copy-btn" data-value="${recovery}">Copiar</button>
            </div>`;
        }
        
        if (cookie) {
          credentialsHTML += `
            <div class="credential-item">
              <span>Cookie: </span><span class="credential-value">••••••••</span>
              <button class="copy-btn" data-value="${cookie}">Copiar</button>
            </div>`;
        }
      }

      if (type === "ip") {
        credentialsHTML += `
          <div class="credential-item">
            <span>IP: </span><span class="credential-value">${ip}</span>
            <button class="copy-btn" data-value="${ip}">Copiar</button>
          </div>`;
      }

      card.innerHTML = `
        <div class="drop-badge">${account.isVip ? 'VIP' : 'ROBLOX'}</div>
        <div class="drop-content">
          <h3 class="drop-title">${username}</h3>
          <div class="account-credentials">${credentialsHTML}</div>
          <div class="drop-footer">
            <button class="claim-btn">Resgatar Agora</button>
            ${isOwner ? '<button class="delete-btn">🗑️</button>' : ''}
          </div>
        </div>
      `;

      // Adicionar event listeners para os botões de cópia
      card.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const value = btn.dataset.value;
          navigator.clipboard.writeText(value).then(() => {
            const originalText = btn.textContent;
            btn.textContent = '✓';
            setTimeout(() => {
              btn.textContent = originalText;
            }, 1500);
          });
        });
      });

      if (isOwner) {
        const del = card.querySelector('.delete-btn');
        del.addEventListener('click', () => {
          if (confirm(`Deletar \"${username}\"?`)) deleteDrop(account.id);
        });
      }

      return card;
    }

    async function deleteDrop(id) {
      try {
        await fetch(`${BACKEND_URL}/api/drops/${id}`, { method: 'DELETE' });
        drops = drops.filter(d => d.id !== id); 
        renderDrops(currentFilter);
      } catch { alert("Erro ao deletar"); }
    }

    function clearDrops() { 
      dropsGrid.innerHTML = ''; 
    }
  </script>
</body>
</html>
