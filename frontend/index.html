<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEKO DROPS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }

    .connection-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 8px 12px;
      border-radius: 20px;
      font-weight: bold;
      z-index: 1000;
      font-size: 12px;
      background: #f44336;
      color: white;
    }

    .connection-status.connected {
      background: #4CAF50;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      font-size: 28px;
      font-weight: 700;
    }

    .logo span {
      color: #8A2BE2;
    }

    .auth-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .login-btn {
      background: #5865F2;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .login-btn:hover {
      background: #4752c4;
    }

    .hidden {
      display: none;
    }

    .drops-container {
      margin-top: 20px;
    }

    .drops-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .drop-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .drop-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .drop-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: #8A2BE2;
      padding: 5px 10px;
      border-bottom-left-radius: 8px;
      font-size: 12px;
      font-weight: 600;
    }

    .drop-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #fff;
    }

    .account-credentials {
      margin-bottom: 20px;
    }

    .credential-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.2);
      padding: 8px 12px;
      border-radius: 6px;
    }

    .credential-item span:first-child {
      font-weight: 600;
      margin-right: 5px;
      min-width: 80px;
    }

    .credential-value {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .copy-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 8px;
      font-size: 12px;
      transition: background 0.3s;
    }

    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .drop-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .claim-btn {
      background: #8A2BE2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .claim-btn:hover {
      background: #7936c7;
    }

    .delete-btn {
      background: rgba(255, 0, 0, 0.2);
      border: none;
      color: #ff4d4d;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .delete-btn:hover {
      background: rgba(255, 0, 0, 0.3);
    }

    .no-drops {
      text-align: center;
      grid-column: 1 / -1;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .mobile-menu-btn {
        display: block;
      }
      
      .drops-grid {
        grid-template-columns: 1fr;
      }
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .filter-btn.active {
      background: #8A2BE2;
    }
  </style>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <div id="connection-status" class="connection-status">❌ Desconectado</div>

  <div class="container">
    <header>
      <div class="logo">NEKO <span>DROPS</span></div>
      <button class="mobile-menu-btn">☰</button>
      <div class="auth-section">
        <div id="user-info" class="user-info hidden">
          <img id="user-avatar" class="user-avatar" src="" alt="Avatar">
          <span id="username"></span>
        </div>
        <button id="login-btn" class="login-btn">Entrar com Discord</button>
      </div>
    </header>

    <div class="drops-container">
      <div class="filters">
        <button class="filter-btn active" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="cookie">Cookie</button>
        <button class="filter-btn" data-filter="auth">Autenticador</button>
        <button class="filter-btn" data-filter="ip">IP</button>
      </div>
      <div id="drops-grid" class="drops-grid">
        <div class="no-drops">
          <h3>Carregando contas...</h3>
        </div>
      </div>
    </div>
  </div>

  <script>
    const BACKEND_URL = 'https://nekodrops-backend.onrender.com';
    const VIP_ROLE_ID = "1399662852448587859";
    const OWNER_ROLE_ID = "1399664650638856303";

    const dropsGrid = document.getElementById('drops-grid');
    const connectionStatus = document.getElementById('connection-status');
    const filterButtons = document.querySelectorAll('.filter-btn');
    let user = null, userRoles = [], drops = [], socket = null;
    let currentFilter = 'all';

    function cleanDiscordText(text) {
      if (!text) return "";
      return text.replace(/```/g, "").trim();
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupWebSocket();
      loadDrops();
      setupEventListeners();
    });

    function setupEventListeners() {
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          filterButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.dataset.filter;
          renderDrops(currentFilter);
        });
      });
    }

    function setupWebSocket() {
      socket = io(BACKEND_URL, { transports: ['websocket', 'polling'] });
      socket.on('connect', () => {
        connectionStatus.textContent = '✅ Conectado';
        connectionStatus.classList.add('connected');
      });
      socket.on('disconnect', () => {
        connectionStatus.textContent = '❌ Desconectado';
        connectionStatus.classList.remove('connected');
      });
      socket.on('new-drop', dropData => { 
        drops.unshift(dropData); 
        renderDrops(currentFilter); 
      });
      socket.on('drop-deleted', id => { 
        drops = drops.filter(d => d.id !== id); 
        renderDrops(currentFilter); 
      });
    }

    async function loadDrops() {
      try {
        const res = await fetch(`${BACKEND_URL}/api/drops`);
        const data = await res.json();
        drops = data.success ? data.drops : [];
      } catch (err) { 
        console.error("Erro ao carregar drops:", err);
        drops = []; 
      }
      renderDrops(currentFilter);
    }

    function renderDrops(filter = 'all') {
      clearDrops();
      
      if (!drops.length) {
        dropsGrid.innerHTML = `<div class="no-drops"><h3>Nenhuma conta disponível</h3></div>`;
        return;
      }
      
      // Filtrar drops conforme seleção
      let filteredDrops = drops;
      if (filter !== 'all') {
        filteredDrops = drops.filter(drop => {
          const auth = cleanDiscordText(drop.authenticator) || "";
          const cookie = cleanDiscordText(drop.cookie) || "";
          const ip = cleanDiscordText(drop.ip) || "";
          
          if (filter === 'auth' && auth) return true;
          if (filter === 'cookie' && cookie && ip) return true;
          if (filter === 'ip' && ip && !cookie && !auth) return true;
          return false;
        });
      }
      
      if (!filteredDrops.length) {
        dropsGrid.innerHTML = `<div class="no-drops"><h3>Nenhuma conta do tipo ${filter} disponível</h3></div>`;
        return;
      }
      
      // Adicionar cada drop ao grid
      filteredDrops.forEach(d => {
        const isOwner = user && userRoles.includes(OWNER_ROLE_ID);
        dropsGrid.appendChild(createRobloxAccountElement(d, isOwner));
      });
    }

    function createRobloxAccountElement(account, isOwner) {
      const card = document.createElement('div');
      card.className = 'drop-card';
      card.dataset.id = account.id;

      const username = cleanDiscordText(account.username) || "Conta Roblox";
      const password = cleanDiscordText(account.password) || "";
      const cookie = cleanDiscordText(account.cookie) || "";
      const ip = cleanDiscordText(account.ip) || "";
      const auth = cleanDiscordText(account.authenticator) || "";
      const recovery = cleanDiscordText(account.recovery) || "";

      // 🔹 Detecta o tipo de embed
      let type = "standard";
      if (auth) type = "auth";
      else if (cookie && ip) type = "cookie";
      else if (ip) type = "ip";

      let credentialsHTML = `
        <div class="credential-item">
          <span>Usuário: </span><span class="credential-value">${username}</span>
          <button class="copy-btn" data-value="${username}">Copiar</button>
        </div>
      `;
      
      if (password) {
        credentialsHTML += `
        <div class="credential-item">
          <span>Senha: </span><span class="credential-value">••••••••</span>
          <button class="copy-btn" data-value="${password}">Copiar</button>
        </div>`;
      }

      if (type === "cookie") {
        credentialsHTML += `
          <div class="credential-item">
            <span>IP: </span><span class="credential-value">${ip}</span>
            <button class="copy-btn" data-value="${ip}">Copiar</button>
          </div>
          <div class="credential-item">
            <span>Cookie: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${cookie}">Copiar</button>
          </div>`;
      }

      if (type === "auth") {
        credentialsHTML += `
          <div class="credential-item">
            <span>Auth: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${auth}">Copiar</button>
          </div>`;
          
        if (recovery) {
          credentialsHTML += `
          <div class="credential-item">
            <span>Recovery Codes: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${recovery}">Copiar</button>
          </div>`;
        }
        
        if (cookie) {
          credentialsHTML += `
          <div class="credential-item">
            <span>Cookie: </span><span class="credential-value">••••••••</span>
            <button class="copy-btn" data-value="${cookie}">Copiar</button>
          </div>`;
        }
      }

      if (type === "ip") {
        credentialsHTML += `
          <div class="credential-item">
            <span>IP: </span><span class="credential-value">${ip}</span>
            <button class="copy-btn" data-value="${ip}">Copiar</button>
          </div>`;
      }

      card.innerHTML = `
        <div class="drop-badge">ROBLOX</div>
        <div class="drop-content">
          <h3 class="drop-title">${username}</h3>
          <div class="account-credentials">${credentialsHTML}</div>
          <div class="drop-footer">
            <button class="claim-btn">Resgatar Agora</button>
            ${isOwner ? '<button class="delete-btn">🗑️</button>' : ''}
          </div>
        </div>
      `;

      // Adicionar event listeners para os botões de cópia
      card.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const value = btn.dataset.value;
          navigator.clipboard.writeText(value).then(() => {
            const originalText = btn.textContent;
            btn.textContent = '✓ Copiado!';
            setTimeout(() => {
              btn.textContent = originalText;
            }, 2000);
          });
        });
      });

      if (isOwner) {
        const del = card.querySelector('.delete-btn');
        del.addEventListener('click', () => {
          if (confirm(`Deletar \"${username}\"?`)) deleteDrop(account.id);
        });
      }

      return card;
    }

    async function deleteDrop(id) {
      try {
        await fetch(`${BACKEND_URL}/api/drops/${id}`, { method: 'DELETE' });
        drops = drops.filter(d => d.id !== id); 
        renderDrops(currentFilter);
      } catch (err) { 
        console.error("Erro ao deletar:", err);
        alert("Erro ao deletar"); 
      }
    }

    function clearDrops() { 
      dropsGrid.innerHTML = ''; 
    }
  </script>
</body>
</html>
